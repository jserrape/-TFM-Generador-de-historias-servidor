{% extends 'base.html' %}
{% block content %}
    <div class="container">
       <div class="col-md-12">
          <br><br><br><br>
          <h1 class="titulo">Nueva historia</h1>
          <hr>

          <!--Historia -->
          <form id="nueva_historia_form">
             <div class="form-group">
                <label for="id">Nombre de la historia</label>
                <input name="nombre_historia" type="text" class="form-control" value="" placeholder="Introduzca nombre de la historia" />
             </div>
             <div class="form-group">
                <label for="id">Imagen de título</label>
                <input name="imagen_historia" type="text" class="form-control" value="" placeholder="Añada imagen de título" />
             </div>
             <div class="form-group">
                <label for="id">Latitud inicial</label>
                <input name="latitud_historia" type="number" step="0.0001" class="form-control" value="37.197" placeholder="Introduzca la latitud inicial" />
             </div>
             <div class="form-group">
                <label for="id">Longitud inicial</label>
                <input name="longitud_historia" type="number" step="0.0001" class="form-control" value="-3.62" placeholder="Introduzca la longitud inicial" />
             </div>
             <div class="form-group">
                <label for="id">Zoom de la cámara</label>
                <input name="zoom" type="text" class="form-control" value="" placeholder="Introduzca el zoom inicial" />
             </div>
             <div class="form-group">
                <label for="id">Descripción de la historia</label>
                <input name="descripcion_historia" type="text" class="form-control" value="" placeholder="Introduzca la descripción de la historia" />
             </div>
          </form>

          <br>
          <hr>

          <!-- Misiones -->
          <div id="div_misiones">
          </div>

          <!-- BOTONES -->
          <div class="row">
             <div class="col-md-12">
                <div class="col-md-6">
                   <div class="form-group">
                      <input value="Nueva misión" class="btn btn-success" id="btn_add_mision"/>
                   </div>
                </div>
                <div class="col-md-6">
                   <div class="form-group">
                      <input value="Crear historia" class="btn btn-primary" id="btn_add_historia"/>
                   </div>
                </div>
             </div>
          </div>
       </div>
    </div>
    <!-- FINAL -->

   <script>
     var debug = true;
     var num = 1;
     if ( debug ){
       var MISION_REST_URL = "http://localhost/rest/mision";
       var HISTORIA_REST_URL = "http://localhost/rest/historia";
     }else{
       var MISION_REST_URL = "https://tfm-historias.herokuapp.com/rest/mision";
       var HISTORIA_REST_URL = "https://tfm-historias.herokuapp.com/rest/historia";
     }

     $('input#btn_add_mision').on('click', function() {
       //Div contenedor
       var para = document.createElement("form");
       para.setAttribute("id", "form_mision_" + num);
       var element = document.getElementById("div_misiones");
       element.appendChild(para);

       //Titulo mision
       document.getElementById("form_mision_"+num).innerHTML = '<h1>Misión #' + num + '</h1>';

       //Nombre de la mision
       document.getElementById("form_mision_"+num).innerHTML = document.getElementById("form_mision_"+num).innerHTML + '<div class="form-group"><label for="id">Nombre de la misión</label><input id="nombre_mision_' + num + '" name="nombre_mision_' + num + '" type="text" class="form-control" value="" placeholder="Introduzca nombre de la misión" /></div>';

       //Icono de la mision
       document.getElementById("form_mision_"+num).innerHTML = document.getElementById("form_mision_"+num).innerHTML + '<div class="form-group"><label for="id">Icono</label><input id="icono_mision_1" name="icono_mision" type="text" class="form-control" value="" placeholder="Introduzca el icono" /></div>';

       //Latitud de la mision
       document.getElementById("form_mision_"+num).innerHTML = document.getElementById("form_mision_"+num).innerHTML + '<div class="form-group"><label for="id">Latitud</label><input id="latitud_mision_1" name="latitud_mision" type="number" step="0.0001" class="form-control" value="37.197" placeholder="Introduzca la latitud" /></div>';

       //Longitud de la mision
       document.getElementById("form_mision_"+num).innerHTML = document.getElementById("form_mision_"+num).innerHTML + '<div class="form-group"><label for="id">Longitud</label><input id="longitud_mision_1" name="longitud_mision" type="number" step="0.0001" class="form-control" value="-3.62" placeholder="Introduzca la longitud" /></div>';

       //Tipo de la mision
       document.getElementById("form_mision_"+num).innerHTML = document.getElementById("form_mision_"+num).innerHTML + '<div class="form-group"><label for="id">Tipo</label><input id="tipo_mision_1" name="tipo_mision" type="text" class="form-control" value="" placeholder="Introduzca el tipo de interacción" /></div>';

       //Código del tipo de la mision
       document.getElementById("form_mision_"+num).innerHTML = document.getElementById("form_mision_"+num).innerHTML + '<div class="form-group"><label for="id">Código de tipo</label><input id="codigo_tipo_mision_1" name="codigo_tipo_mision" type="text" class="form-control" value="" placeholder="Introduzca el código de la interacción" /></div>';

       //Precedentes de la mision
       document.getElementById("form_mision_"+num).innerHTML = document.getElementById("form_mision_"+num).innerHTML + '<div class="form-group"><label for="id">Precedentes</label><input id="precedentes_mision_1" name="precedentes_mision" type="text" class="form-control" value="" placeholder="Introduzca las misiones precedentes" /></div>';

       //Audio de la mision
       document.getElementById("form_mision_"+num).innerHTML = document.getElementById("form_mision_"+num).innerHTML + '<div class="form-group"><label for="id">Pista de audio</label><input id="audio_mision_1" name="audio_mision" type="text" class="form-control" value="" placeholder="Introduzca la pista de audio" /></div>';

       //Descripción de la mision
       document.getElementById("form_mision_"+num).innerHTML = document.getElementById("form_mision_"+num).innerHTML + '<div class="form-group"><label for="id">Descripción</label><input id="descripcion_mision_1" name="descripcion_mision" type="text" class="form-control" value="" placeholder="Introduzca la descripción de la misión" /></div>';

       //Separacion final
       document.getElementById("form_mision_"+num).innerHTML = document.getElementById("form_mision_"+num).innerHTML + '<br><hr>';

       num= num + 1;
      });

      $('input#btn_add_historia').on('click', function() {
        console.log("Hello world!");
        //POST de la historia
        $.ajax({
          url: HISTORIA_REST_URL,
          type: 'POST',
          data: $('#nueva_historia_form').serialize(),
          success: function (){
            //location.reload();
          },
          error: function (request, message, error){
            console.log("Error performing POST on " + HISTORIA_REST_URL);
          }
        });

        //POST de las misones
        for(var i=1; i < num; i++){
          console.log("Enviando historia #"+i);
          $.ajax({
            url: MISION_REST_URL,
            type: 'POST',
            data: $('form#form_mision_'+i).serialize(),
            success: function (){
              //location.reload();
            },
            error: function (request, message, error){
              console.log("Error performing POST on " + HISTORIA_REST_URL);
            }
          });
        }
      });
   </script>
 </body>
</html>
{% endblock %}
